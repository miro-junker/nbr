<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Gyro â†’ WebSocket</title>
</head>
<body>
<script>
const WS_URL = "wss://nobrakes.cz?role=sensor";
const ws = new WebSocket(WS_URL);


let desiredHz = 120;
let sampleInterval = 1000 / desiredHz;
let lastSent = 0;


async function requestPermissionsIfNeeded(){
if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function'){
try {
const r = await DeviceMotionEvent.requestPermission();
if (r !== 'granted') throw new Error('Permission denied');
} catch(e){ console.error(e); }
}
}


(async function(){
await requestPermissionsIfNeeded();


window.addEventListener('deviceorientation', (ev)=>{
const now = Date.now();
if (now - lastSent < sampleInterval) return;
lastSent = now;
const payload = {
t: now,
alpha: ev.alpha, // z-axis
beta: ev.beta, // x-axis
gamma: ev.gamma // y-axis
};
if (ws.readyState === WebSocket.OPEN) {
ws.send(JSON.stringify(payload));
}
}, true);
})();
</script>
</body>
</html>
